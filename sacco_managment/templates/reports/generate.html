{% extends "partials/dashboard-base.html" %}
{% load static %}
{% block content %}

<!-- Dashboard Section start -->
<section class="dashboard-section body-collapse reports">
  <div class="overlay pt-120">
    <div class="container-fruid">
      <div class="main-content">
        <div class="head-area d-flex align-items-center justify-content-between">
          <h4>Generate Financial Report</h4>
          <a href="{% url 'reports:report_history' %}" class="btn btn-sm btn-outline-primary">
            <i class="fas fa-history"></i> View History
          </a>
        </div>

        <div class="report-form-card">
          <form method="post" id="reportForm">
            {% csrf_token %}
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label">Start Date</label>
                  {{ form.start_date }}
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label">End Date</label>
                  {{ form.end_date }}
                </div>
              </div>
            </div>

            <div class="form-group mb-4">
              <label class="form-label">Report Format</label>
              <div class="format-options">
                {% for value, text in form.format.field.choices %}
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="format" id="format_{{ value }}" 
                         value="{{ value }}" {% if form.format.value == value %}checked{% endif %}>
                  <label class="form-check-label" for="format_{{ value }}">
                    <i class="fas fa-file-{% if value == 'PDF' %}pdf text-danger{% else %}excel text-success{% endif %} me-2"></i>
                    {{ text }}
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>

            <div class="form-footer">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-file-download me-2"></i> Generate Report
              </button>
              <a href="{% url 'account:dashboard' %}" class="btn btn-outline-secondary">Cancel</a>
            </div>
          </form>
        </div>

        {% if form.errors %}
        <div class="alert alert-danger mt-3">
          <strong>Error:</strong> Please correct the following:
          <ul>
            {% for field, errors in form.errors.items %}
              {% for error in errors %}
                <li>{{ error }}</li>
              {% endfor %}
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
<!-- Dashboard Section end -->

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize date pickers
    flatpickr("#id_start_date", {
        dateFormat: "Y-m-d",
        maxDate: "today",
        defaultDate: "{{ form.start_date.value|default:'' }}"
    });
    
    flatpickr("#id_end_date", {
        dateFormat: "Y-m-d",
        maxDate: "today",
        defaultDate: "{{ form.end_date.value|default:'' }}"
    });

    // Update end date min date when start date changes
    document.getElementById("id_start_date").addEventListener("change", function() {
        const endDatePicker = flatpickr("#id_end_date");
        endDatePicker.set("minDate", this.value);
    });
});
</script>
{% endblock %}