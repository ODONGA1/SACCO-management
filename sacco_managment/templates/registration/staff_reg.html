{% extends 'partials/base.html' %}
{% load static %}
{% block content %}

<!-- Login Reg start -->
<section class="login-reg">
    <div class="overlay pt-120">
        <div class="container">
            <div class="row align-items-center justify-content-center">
                <div class="col-xl-6 order-xl-0 order-1">
                    <div class="sec-img d-rtl position-relative">
                        <img src="{% static 'assets/images/login-reg-bg.png' %}" class="max-un" alt="SACCO Staff Portal">
                        <div class="security-overlay p-4">
                            <h4 class="text-white"><i class="fas fa-shield-alt me-2"></i> Security Features</h4>
                            <ul class="security-features">
                                <li><i class="fas fa-check-circle text-success me-2"></i> End-to-end encryption</li>
                                <li><i class="fas fa-check-circle text-success me-2"></i> Activity monitoring</li>
                                <li><i class="fas fa-check-circle text-success me-2"></i> Suspicious login detection</li>
                                <li><i class="fas fa-check-circle text-success me-2"></i> Two-factor authentication</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-xl-5">
                    <div class="login-card shadow-lg rounded-3 p-4 bg-white">
                        <div class="section-text text-center mb-4">
                            <div class="logo mb-3">
                                <img src="{% static 'assets/images/logo-icon.png' %}" alt="SACCO Logo" width="60">
                            </div>
                            <h5 class="sub-title text-uppercase text-primary fw-bold">Secure Access Portal</h5>
                            <h2 class="title display-6 fw-bold">Staff & Admin Login</h2>
                            <p class="text-muted mt-3">
                                <i class="fas fa-user-shield me-1"></i>
                                For authorized personnel only
                            </p>
                        </div>
                        
                        <!-- Messages/Alerts -->
                        <div class="messages-container">
                            {% if form.errors %}
                                <div class="alert alert-danger alert-dismissible fade show">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Authentication Failed:</strong> Invalid username or password
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endif %}
                            
                            {% if messages %}
                                {% for message in messages %}
                                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% else %}exclamation-circle{% endif %} me-2"></i>
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                            
                        <form method="POST" id="staffLoginForm" class="needs-validation" novalidate>
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{{ request.GET.next }}">
                            
                            <div class="mb-4">
                                <label for="id_username" class="form-label fw-medium">Username</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light">
                                        <i class="fas fa-user-tie text-primary"></i>
                                    </span>
                                    <input type="text" class="form-control form-control-lg" required name="username" 
                                           id="id_username" placeholder="Staff ID or Email"
                                           autocomplete="username" autofocus>
                                    <div class="invalid-feedback">
                                        Please enter your username
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="d-flex justify-content-between">
                                    <label for="id_password" class="form-label fw-medium">Password</label>
                                    <a href="#" class="text-decoration-none text-primary small">Forgot Password?</a>
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text bg-light">
                                        <i class="fas fa-lock text-primary"></i>
                                    </span>
                                    <input type="password" class="form-control form-control-lg" required name="password" 
                                           id="id_password" placeholder="Enter your password"
                                           autocomplete="current-password">
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        Please enter your password
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="remember" name="remember">
                                    <label class="form-check-label" for="remember">
                                        Keep me signed in
                                    </label>
                                </div>
                            </div>
                            
                            <div class="role-selection mb-4">
                                <h6 class="mb-3 fw-medium">Login As:</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check role-card p-3 border rounded h-100">
                                            <input class="form-check-input" type="radio" 
                                                   name="login_type" id="staffLogin" value="staff" checked>
                                            <label class="form-check-label w-100" for="staffLogin">
                                                <div class="text-center">
                                                    <div class="icon-container bg-primary-light rounded-circle p-3 mb-3">
                                                        <i class="fas fa-user-cog fa-2x text-primary"></i>
                                                    </div>
                                                    <h6 class="fw-bold">Staff</h6>
                                                    <small class="text-muted d-block">Loan officers, support staff</small>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check role-card p-3 border rounded h-100">
                                            <input class="form-check-input" type="radio" 
                                                   name="login_type" id="adminLogin" value="admin">
                                            <label class="form-check-label w-100" for="adminLogin">
                                                <div class="text-center">
                                                    <div class="icon-container bg-success-light rounded-circle p-3 mb-3">
                                                        <i class="fas fa-user-shield fa-2x text-success"></i>
                                                    </div>
                                                    <h6 class="fw-bold">Admin</h6>
                                                    <small class="text-muted d-block">System administrators</small>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid mb-4">
                                <button class="btn btn-primary btn-lg py-3 fw-bold" type="submit" id="loginButton">
                                    <i class="fas fa-sign-in-alt me-2"></i> 
                                    <span class="button-text">Login to Portal</span>
                                </button>
                            </div>
                            
                            <div class="text-center mt-4 pt-3 border-top">
                                <p class="mb-0 small text-muted">
                                    <i class="fas fa-exclamation-triangle me-1 text-warning"></i>
                                    Unauthorized access is prohibited and monitored
                                </p>
                                <p class="mt-2 small">
                                    For member login, <a href="{% url 'user_auths:login' %}" class="text-decoration-none">click here</a>
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Login Reg end -->

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(function(button) {
        button.addEventListener('click', function() {
            const input = this.previousElementSibling;
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            
            const icon = this.querySelector('i');
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
            
            // Change button style based on visibility
            if (type === 'text') {
                this.classList.add('btn-primary');
                this.classList.remove('btn-outline-secondary');
            } else {
                this.classList.remove('btn-primary');
                this.classList.add('btn-outline-secondary');
            }
        });
    });
    
    // Role selection styling
    document.querySelectorAll('.role-card').forEach(function(card) {
        card.addEventListener('click', function() {
            document.querySelectorAll('.role-card').forEach(function(c) {
                c.classList.remove('selected-role');
            });
            this.classList.add('selected-role');
            this.querySelector('input').checked = true;
        });
    });
    
    // Form validation and submission handling
    const form = document.getElementById('staffLoginForm');
    const loginButton = document.getElementById('loginButton');
    const buttonText = loginButton.querySelector('.button-text');
    
    form.addEventListener('submit', function(e) {
        // Basic validation
        if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
        } else {
            // Show loading state
            loginButton.disabled = true;
            buttonText.textContent = 'Authenticating...';
            loginButton.insertAdjacentHTML('beforeend', 
                '<span class="spinner-border spinner-border-sm ms-2" role="status" aria-hidden="true"></span>');
        }
        
        form.classList.add('was-validated');
    });
    
    // Auto focus username field
    document.getElementById('id_username').focus();
    
    // Add animation to form elements
    setTimeout(function() {
        document.querySelectorAll('.form-control').forEach(function(input) {
            input.classList.add('animate-input');
        });
    }, 300);
});
</script>

<style>
.login-card {
    border: 1px solid rgba(13, 110, 253, 0.15);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.08) !important;
}

.role-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
}

.role-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
}

.role-card.selected-role {
    border-color: #0d6efd;
    background-color: rgba(13, 110, 253, 0.05);
    box-shadow: 0 0.5rem 1rem rgba(13, 110, 253, 0.15);
}

.toggle-password {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    transition: all 0.3s ease;
}

.icon-container {
    width: 70px;
    height: 70px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.bg-primary-light {
    background-color: rgba(13, 110, 253, 0.1) !important;
}

.bg-success-light {
    background-color: rgba(25, 135, 84, 0.1) !important;
}

.security-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 0 0 10px 10px;
}

.security-features {
    list-style: none;
    padding-left: 0;
    margin-bottom: 0;
}

.security-features li {
    margin-bottom: 8px;
}

.animate-input {
    animation: fadeInUp 0.5s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 767.98px) {
    .sec-img {
        margin-bottom: 2rem;
    }
}
</style>
{% endblock %}